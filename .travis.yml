language: node_js
dist: trusty
sudo: false
node_js:
- lts/*
services:
- docker
before_script:
- if [ "$TARGET" == "raspberrypi3" ]; then docker run --rm --privileged multiarch/qemu-user-static:register
  --reset; fi
- cd gateway
- docker build -t "${DOCKER_IMAGE}:latest" -f $DOCKER_FILE .
- docker tag "${DOCKER_IMAGE}:latest" "${DOCKER_IMAGE}:${TRAVIS_BUILD_NUMBER}"
- cd ../
script:
- cd gateway
- npm ci
- cd ../
deploy:
- provider: script
  script: docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD" && docker push
    "$DOCKER_IMAGE" && docker push "${DOCKER_IMAGE}:${TRAVIS_BUILD_NUMBER}"
  on:
    branch: master
matrix:
  include:
  - env: TARGET=raspberrypi3 DOCKER_IMAGE=lightelligenceio/olt-gateway-lite-rpi3 DOCKER_FILE=Dockerfile-raspberrypi3
    sudo: true
env:
  global:
  - secure: M9a//tqgRi78YjHL+aO7s9UBwTitEAMgwzPwvDmPCVHPwNL/XNn/iVnBpAM3wt5nuSZL35kX8tzAvySKz216KQvsFxAeofY9apbwH8CPBGz/65v0krcfr83pY58iCCMTe1eZ6CW5Ft8h3J3SwaPRBm8ZyaugoDlE0kwB8eGCs3659KhDz1T5wRUBG0A5M7PjyYy511InqaVwRVpjpqrNXVB8IPYWYwdBT3EYu+0pZ2YYZO5fdKk7YcbrtHz6OnwbTHGRLE/MSpUd9k89O4d75ZxcDOg5nmTaylLwgaSlSj4HFClekRGQ3QGwmyklFcmSzLJxZxdYnvX26+pMv3dyklnk0E1qG5wAuUofRAB5CDAjSwuw/9OOz/TFhAJb+yXvXIccPPbZxUQjN7Yo3flMUtXcE1Ml5XaviD9ataDb2qJIbiFIDPW3IpVxM/+77ndjqyez2T7L4qS57N1q4JyCAcm8qzB6UivZSp1G0BNVvSn5l5hTTgy2+Uv12/F+JUTLuSh7Yrh+OfzK86CNPhNMzTkCKEbhRmZNbE3QlsIbFc6a5jb1qMqWml2yobNNBggx7l66KX9HCoEu1Mnq+qVnyGfSfU2LKoPIHiUIYjkKC3ZKpzuaG6bMKzCTliKR/PaCI2lyHVhdUUB7K+Tin5juIwx1rvfINFnRRaFi542yplY=
  - secure: HYwkhGNqT9Dd+WcN40hFv1C3jkU2lroLPhm05sGsi1YcuRiVhGXpYh4i2UauWWRGCYjzA6GX7AfSZOEhygDIZy6f4r81krvlJ9/fxJ6ukV/LZE6DuFjQbsf/g7so1sEbxfIPFZ2pC4eJ6oJ4CaSHugKktJnVpBEt2CYzz1nG0QcYnwi7V460DASy30pDVMSTP+7I0TkH4yHIiGf7gG6mM67xlKCHH1HzgWJ0EtexUal+UesmVbsC3B/rqUgnZRAbvJWD7X77qz8Zm/rJV7SwHWcfqD93tzBe3qbV92MNYfVhazvEtS5ink7R6CbxKpRam5QjZuVJOcngAEgySw1qMjXUfID+HWTbslIS4JlqnRcMNGwegxtMSbgTETaGjYDdJny2dYnT5WJT34WvSmdYvxps1zhcocDTr5jJ18aPnD5ozDzxsDLxeweTaVhwgkmK6igaXFSLP9yGYu3//By2AJX2P3uv3O+SDKOABWR2J/GsIylEaM0KJ8oY1ZPwQ93yjI3ICkz0OcPblMGlNTM3AjMSHbLGDj4P4X7BdY6CtweIsDajCxu3kqAZIWWqc7WJR+LCYGoHlj2ehuPAtTu0SVQpowB2nsdhpwO8RbPS5dmn1acqflke9UVSC+DRw/+L8wHndCzSKko/boXfr3arzyK+/dkW3wXGxujlzAxFjjQ=
